# P7 MIPS 微系统 (中断和异常)

P7 修订版，对原有的(较为混乱的) P7 源码进行了一定程度的修改和重构.

## 源码说明

全部源代码文件位于 `src` 目录下，其中 `mips.v` 为整个工程的顶层模块。

顶层模块要求：

```verilog
module mips (
    input clk,          // 时钟
    input reset,        // 同步复位, 高电平有效
    input interrupt,    // 外部中断, 高电平有效
    output [31:0] addr  // 宏观 PC, 具体含义详见课设指导书与 《See Mips Run Linux》
);
```
其他源码文件及目录说明：
- `Bridge.v` ：桥模块，用于连接 CPU 与外设。本实验中的外设包括两个定时器 `Timer`，指令存储器 `IM` 与数据存储器 `DM` 。
- `device` 目录：本实验中外设模块的源代码。<br>
注意：当前的 `IM` 与 `DM` 模块**不可综合**！（不可综合原因：1. 使用了不可综合的语法 `initial` 进行初始化；2. 采用寄存器数组实现 RAM）
- `cpu` 目录：CPU 核心的源代码，其中 CPU 顶层模块为 `cpu.v`。
- `include` 目录：所有 Verilog 头文件。


## 设计说明

CPU 采用五级流水线设计，分为 F (取指), D(译码), E(执行), M(访存), W(写回) 五个流水级。每个流水级封装了一个顶层模块，对应命名形如 `Stage*.v` 的源代码文件。

地址空间同 MARS 中的 `CompactDataAtZero` 模式：
- `.data` 可用地址为 `0x0000` - `0x2ffc`
- `.text` 起始地址为 `0x3000` - `0x4ffc`
- `.ktext` 只涉及异常中断处理, 异常中断统一入口为 `0x4180` 
- 两个定时器的地址空间分别为 `0x7f00` - `0x7f0b` 与 `0x7f10` - `0x7f1b` 

在本设计中指令存储器和数据存储器不再嵌入 CPU 内，而是拆分到了 Bridge 以外，当做外设对待.
